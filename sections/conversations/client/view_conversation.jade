template(name='view_conversation')
    unless editing
        a.ui.basic.circular.button(href='/conversations')
            +icon48 name='chevron-left' classes='ui mini inline image'
            strong Conversations
        .ui.container
            h1.ui.center.aligned.header View Conversation 
            .ui.stackable.grid
                .ten.wide.column
                    // +minimal_conversation_view this
                    +conversation_messages_pane this
                .five.wide.column
                    .ui.dividing.header 
                        +icon48 name='line-chart'
                        |Stats
                    .ui.small.horizontal.statistic
                        .value #{message_count}
                        .label Total Messages
                    .ui.small.horizontal.statistic
                        .value #{unread_message_count} 
                        .label Unread Messages
                    .ui.dividing.header 
                        +icon48 name='align-left'
                        |Description
                    |!{content}
                    .ui.dividing.header
                        +icon48 name='queue'
                        |Participants
                    .ui.divided.relaxed.list
                        each participants
                            .item
                                img.ui.avatar.image(src="{{c.url profile.image_id width=100 height=100 gravity='face' crop='fill'}}")
                                .content
                                    .header
                                        |#{name}
                                        if subscribed
                                            .ui.small.basic.green.label
                                                |Subscribed
                                        else
                                            .ui.basic.label
                                                |Not Subscribed
                                        .sub.header @#{username}
                                    .description
                                        each five_tags
                                            .ui.tiny.basic.label #{this}
                
                    .ui.dividing.header 
                        +icon48 name='tags'
                        |Conversation Tags
                    each tags
                        .ui.basic.large.label.doc_tag #{this}
                    .ui.dividing.header 
                        +icon48 name='sports=mode'
                        |Actions
                    +subscribe_button
                    +bookmark_button
                    unless is_author
                        +resonate_button
                        +thanks_button
                    +resonates_list
    
                    .ui.dividing.header 
                        +icon48 name='eye'
                        |Visibility
                    if published
                        .ui.basic.green.large.label 
                            i.unlock.icon
                            | Public
                    else
                        .ui.basic.large.label 
                            i.lock.icon
                            | Private
                    .ui.header Started by #{author.name} #{when}
                    .ui.divider
                    if can_edit
                        +edit_button
    else
        .ui.container
            h1.ui.center.aligned.header Edit Conversation
            .ui.stackable.grid
                .twelve.wide.column
                    .ui.form
                        +participants
                        +tags
                        +content
                .four.wide.column
                    if tags
                        a.ui.fluid.green.big.button(href="/view/#{_id}") 
                            |Save Conversation
                    else
                        .ui.fluid.green.big.disabled.button Add Tags to Save
                    #delete_doc.ui.small.fluid.red.compact.button 
                        |Delete Conversation
                    .ui.divider
                    | Private conversations are only shown to participants you invite.  
                    +published
