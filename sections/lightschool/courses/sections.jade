template(name='view_sections')
    .ui.stackable.padded.grid
        .row
            .three.wide.center.aligned.column
            .ten.wide.column
                h1.ui.inverted.center.aligned.header 
                    +icon96 name=icon_class classes='ui inline image'
                    |#{parent.title} sections
            .three.wide.center.aligned.column
                // if can_edit
                //     +edit_button
        .row
            .sixteen.wide.centered.column
                .ui.cards
                    each children
                        +grid_item
                        // .ui.segment
                        //     a.ui.header(href="/view/#{_id}") 
                        //         +icon48 name=icon_class
                        //         |#{number}:
                        //         |#{title}


template(name='view_section')
    .ui.stackable.padded.grid
        .row
            .three.wide.center.aligned.column
            .ten.wide.column
                h1.ui.inverted.center.aligned.header 
                    +icon96 name=icon_class classes='ui inline image'
                    |#{number}: #{title}
            .three.wide.center.aligned.column
                if can_edit
                    +edit_button
        .row
            .centered.three.wide.column
                unless is_admin
                    if younger_sibling
                        a.ui.white.inverted.basic.circular.button(href="/view/#{younger_sibling._id}")
                            // if younger_sibling.completed
                            if younger_sibling.icon_class
                                +icon48 name=younger_sibling.icon_class classes='ui mini spaced image'
                            else
                                +icon48 name='checked' classes='ui mini spaced image'
                            // else
                            //     if younger_sibling.icon_class
                            //         +dots100 name=younger_sibling.icon_class classes='ui mini spaced image'
                            //     else
                            //         +icon48 name='circle' classes='ui mini spaced image'
                            | #{younger_sibling.title}
                            // | #{younger_sibling.body}
                else
                    +completed_list
            .centered.ten.wide.column
                +view_content
                if transcript
                    +view_transcript
                .center.aligned
                    +mark_watched_button
                if read
                    +section_questions
            .centered.three.wide.column
                unless is_admin
                    if older_sibling
                        // if completed
                        a.ui.white.inverted.basic.circular.button(href="/view/#{older_sibling._id}")
                            | #{older_sibling.title}
                            if older_sibling.icon_class
                                +icon48 name=older_sibling.icon_class classes='ui mini spaced image'
                                // if older_sibling.completed
                                // else
                                //     +dots100 name=older_sibling.icon_class classes='ui mini spaced image'
                        // else
                        //     .ui.basic.disabled.circular.button
                        //         | #{older_sibling.title} &nbsp;
                        //         if older_sibling.icon_class
                        //             if older_sibling.completed
                        //                 +icon48 name=older_sibling.icon_class classes='ui mini spaced image'
                        //             else
                        //                 +dots100 name=older_sibling.icon_class classes='ui mini spaced image'
                else
                    .shadowed.padded10
                        .ui.dividing.header Completors
                    .ui.dividing.header Readers
                        .ui.list
                            each readers
                                .item
                                    +user_image_name user_id=this._id
                        .ui.dividing.header Questions
                        .ui.list
                            each children
                                .item 
                                    .ui.header #{title}
                                    |#{children_count} Answers
                                    each child_authors
                                        .item
                                            +user_image_name user_id=this._id


template(name='completed_list')
    .shadowed.padded10
        +check_completion_button
        .ui.dividing.header Completors
        .ui.list
            each completed_ids
                .item
                    +user_image_name user_id=this



template(name='section_questions')
    h2.ui.center.aligned.header #{children_count} Questions
    .ui.styled.fluid.question_accordion.accordion
        each questions
            +section_question

template(name='section_question')
    .title
        .ui.header
            // +icon48 name=icon_class
            | Question #{number}
            if is_admin
                small #{child_count} answers
                +child_authors
            i.dropdown.icon
    .content
        +view_content
        unless is_admin
            +my_answer
            .published_answers.styled.accordion
                .title
                    i.unlock.fitted.icon
                    |#{published_children_count} Published Answers
                    i.dropdown.icon
                .content
                    .ui.threaded.comments
                        each published_answers
                            +answer
                            if has_children
                                .ui.grid
                                    .two.wide.column
                                        .ui.vertical.divider
                                    .fourteen.wide.column
                                        .comments
                                            each children
                                                +answer
                                
        if is_admin
            .private_answers.styled.accordion
                .title
                    i.lock.fitted.icon
                    |Private Answers
                    i.dropdown.icon
                .content
                    .ui.threaded.comments
                        each private_answers
                            +answer
                            if has_children
                                .ui.grid
                                    .two.wide.column
                                        .ui.vertical.divider
                                    .fourteen.wide.column
                                        .comments
                                            each children
                                                +answer
            +edit_button
            +view_full_button


template(name='edit_section_question')
    .ui.header Edit Question
        +edit_number
        +edit_text
        +edit_content

template(name='answer')            
    .comment(class=published_class)
        a.avatar
            img(src="{{c.url author.profile.image_id width=100 height=100 gravity='face' crop='fill'}}")
        .content
            a.author 
                |&nbsp;
                |#{author.name}
            .metadata
                .date #{when}
                if child_count
                    .rating #{child_count} Responses
                if upvoters
                    // .test #{upvoters.length} Thanked by
                    .test Thanked by
                        each upvoted_users
                            |#{name}
                            // img.ui.avatar.image(src="{{c.url profile.image_id width=50 height=50 gravity='face' crop='fill'}}")
                    
            .text
                +view_content
            .actions
                if is_author
                    a.edit(href="/edit/#{_id}") Edit
                else
                    a.reply Reply
                    a.thank 
                        if up_voted
                            strong Thanks!
                        else 
                            |Thank
                    // a.give Give Karma
                // +thanks_button
                // +respond_button
                
        // |#{body}
        // div
        //     +author_info
        //     |#{when}
        //     +view_full_button






template(name='edit_section')
    .ui.form
        .field
            +edit_number
        .field
            +edit_title
        .field
            +edit_icon
        .field
            +edit_content
        .field
            +edit_transcript



template(name='my_answer')
    with answer
        .ui.segment(class=published_class)
            .ui.top.left.attached.basic.label 
                |Your Answer
            if is_editing
                +edit_content
                +published
            else
                +view_content
            |#{when}
            +session_edit_button
            // .center.aligned